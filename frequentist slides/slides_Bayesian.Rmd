---
title: "Attachment Efficiency Analysis (Mixed Effects Model)"
author: "Jun"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.width = 9,
  fig.height = 5
)

library(dplyr)
library(ggplot2)
library(lme4)
```


## Bayesian Hierarchical Model 

**Motivation:**
1. The model selection is based on the AIB/BIC results among a collection of candidate LMMs
2. We are interested in how the total  retained area depends on rotation, particle density and work of adhesion, and how particle type affects the slope of the rotation-area relationship
3. We adopt a Bayesian hierarchical framework to enable particle pooling across particle types and samples

**Model:**

$$
\begin{aligned}
y_{pij} &= \beta_0+ \beta_1\text{WOA}_p + (\beta_2 + \gamma_p) \text{rpm}_j + \beta_3(\text{rpm}_j\times \text{density}_p) + \mu_{i} + a_p + \epsilon_j 
\end{aligned}
$$

Here,

- $y_{pij}$ is the total area in (particle, sample) cell, 797 observations
- $\text{WOA}_p$ is the work of adhesion of particle type for type $p$
- $\text{rpm}_j$ is the rotation speed (RPM) for each observation $j$
- $\text{density}_p$ the density of particle type 
- $\mu_{i}$ is the (type, sample)-level random intercept for (particle, sample) cell
- $a_p$ is the type-level random intercept
- $\gamma_{p}$ is the type-specific random slope representing the deviations from the mean rotation effect 
- All the continuous variables are standardized for a easier prior assumptions

---

## Prior Specification & MCMC Initializations

.pull-left[
*Prior Assumptions*

$$
\begin{aligned}
\beta_k &\sim \mathcal{N}(0,\sigma_\beta^2), \qquad k=0,1,2,3,\\
\mu_i &\sim \mathcal{N}(0,\sigma_\mu^2), \qquad i=1,\ldots,S,\\
\gamma_p, a_p &\sim \mathcal{N}(0,\sigma_\gamma^2), \qquad p=1,\ldots,P,\\
\sigma_\ell &\sim \text{half-}t(0,2.5), \qquad \ell\in\{\beta,\mu,\gamma\},\\
\varepsilon_{pij} &\sim \mathcal{N}(0,\sigma^2),\\
\sigma &\sim \text{half-}t(0,2.5).
\end{aligned}
$$


- The half-t distributions provides weak-informative and heavy-tailed for data-driven purpose.]

.pull-right[
*Initializations:*

$$
\begin{aligned}
\beta_k^{(0)} &\sim \mathcal{N}(0,1^2), \qquad k=0,1,2,3,\\
\mu_i^{(0)} &\sim \mathcal{N}(0,0.5^2), \qquad i=1,\ldots,S,\\
\gamma_p^{(0)}, a_p^{(0)} &\sim \mathcal{N}(0,1^2), \qquad p=1,\ldots,P,\\
\sigma,\sigma_\mu,\sigma_\beta,\sigma_\gamma &\sim \mathrm{Uniform}(0.2,2).
\end{aligned}
$$


- We use over-dispersed but reasonable initial values for all parameter in our 4 MCMC chains for a better MCMC convergence diagnostics. 
]

---

## MCMC Sampling Process

**Adaptive period:** 500 iterations

**Burn-in:** 2,000 iterations

**Sampling:** 700,000 iterations each chain with thinning = 1

**Rafery-Lewis Diagnostics for required sampling size:** Among all fixed association parameters, the model requires at least 616 burn-in and 687,456 iterations/chain, indicating our MCMC setting is adequate for analysis

**Effective Sample Size:**

| beta_0 (intercept) | beta_1 (WOA effect) | beta_2 (Mean Rotation Effect)| beta_3 (Rotation x Density Effect) |
|-------------------|----------|------------|---------|
|  12877.23 | 8702.58 | 7572.06   | 13540.37  |

| gamma_alfalfa | gamma_flyash | gamma_graphite | gamma_gypsum | gamma_LG | gamma_SiO2 | gamma_solos.|
|-------------------|----------|------------|---------|---------|---------|---------|
| 8491.48 | 10609.71  | 10493.57   |  8010.32  |  8385.73    |  8698.95    |  11215.87  |


---

## Convergence Analysis

**Gelman-Rubin Factor:** Gelam-Rubin $\hat{R} = 1$ for all fixed effects and random slopes. 

**Gelman-Rubin Plots:**

.pull-left[
<img src="figs/gelman_rubin_1_new.png" width="100%" />
]

.pull-right[
<img src="figs/gelman_rubin_2_new.png" width="100%" />
]

- All shrink factor shrink to one quickly.  

---

## Inference (Posterior Summary)

.pull-left[

| Parameter | Mean | 2.5% | 97.5% | P(>0) | P(<0) |
|:--|--:|--:|--:|--:|--:|
| Intercept | 0.01 | -0.31 | 0.34 | 0.53 | 0.47 |
| WOA effect | 0.15 | -0.16 | 0.57 | 0.79 | 0.21 |
| Mean rotation effect | -0.18 | -0.61 | 0.11 | 0.16 | 0.84 |
| Rotation × density | -0.03 | -0.34 | 0.28 | 0.43 | 0.57 |
| Rot. for alfalfa | -0.59 | -0.71 | -0.47 | 0.00 | 1.00 |
| Rot. for flyash | -0.18 | -0.52 | 0.13 | 0.10 | 0.89 |
| Rot. for graphite | -0.68 | -1.02 | -0.36 | 0.00 | 1.00 |
| Rot. for gypsum | -0.32 | -0.39 | -0.24 | 0.00 | 1.00 |
| Rot. for LQ | -0.22 | -0.34 | -0.11 | 0.00 | 1.00 |
| Rot. for SiO₂ | -0.11 | -0.35 | 0.15 | 0.17 | 0.83 |
(rounded to 0.01. Values shown are posterior means, 95% credible intervals, and posterior probabilities.)
]

.pull-right[
<img src="figs/inference_new.png" width="100%" />

Work of adhesion shows a insignificant positive effect, rotation tends to reduce retained area at the average level, but the magnitude and significance of this reduction varies substantially by particle type, while the rotation–density interaction appears weak.
]

---

## Conclusions

**Key inference**

- Work of adhesion has a **positive association** with retained area according to posterior mean but shows **insignificant**.
- Rotation tends to **reduce retained area on average** insignificantly, but the magnitude and significance of this effect **varies substantially by particle type**.
- The rotation–density interaction is **weak**, with posterior mass centered near zero.

**Limitations**

- Density effects are inferred indirectly through an interaction term and may be underestimated.
- The model focuses on linear effects and does not capture potential nonlinearities.
- Required number of sampling is large, leading to large computational cost.

**Future work**

- Explore more **nonlinear effects** of predictors.
- Allow different structured prior assumptions informed by material properties.
- Improving the computational efficiency.








